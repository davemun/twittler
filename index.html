<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <script>

      $(document).ready(function(){
        var $body = $('body');
        $body.html('');
		var tweetDisplayLimit = 10;
		var refreshRate = 1000;
		var currentLastTweet = Math.max(0, streams.home.length - 1 - tweetDisplayLimit);
		var currentFirstTweet = (currentLastTweet + tweetDisplayLimit - 1);
		var nextFirstTweet, nextLastTweet;
		
		var scheduleDisplayTweets = function() {
			//displayTweets(); //deprecated into an initial displayer and then a less expensive new-only itemized updater - updateTweets();
			updateTweets();
			setTimeout(scheduleDisplayTweets, refreshRate);
		};
		
		var displayTweets = function() {
			var index = currentFirstTweet;
			while(index > currentLastTweet){
			  var tweet = streams.home[index];
			  var $tweet = $('<div></div>');
			  $tweet.text('@' + tweet.user + ': ' + tweet.message);
			  $tweet.addClass('tweet');
			  $tweet.appendTo($body);
			  index -= 1;
			};
		//TWEET AUTO DISPLAYER
		scheduleDisplayTweets();
		};
		
		var updateTweets = function() {
			nextFirstTweet = streams.home.length - 1;
			nextLastTweet = nextFirstTweet - tweetDisplayLimit + 1;
			var numNewTweets = nextFirstTweet - currentFirstTweet - 1;
			while(numNewTweets >= 0){
			  var tweet = streams.home[nextFirstTweet - numNewTweets];
			  var $tweet = $('<div></div>');
			  $tweet.text('@' + tweet.user + ': ' + tweet.message);
			  $tweet.addClass('tweet');
			  $tweet.prependTo($body);
			  var $tweetDate = $('<div></div>');
			  $tweetDate.text('..............' + tweet.created_at);
			  $tweetDate.addClass('tweetDate');
			  $tweetDate.appendTo($body.find('.tweet').first())
			  $body.find('.tweet').last().remove();
			  numNewTweets -= 1;
			};
		currentFirstTweet = nextFirstTweet;
		};
		
		

		
		//DEBUG SECTION
		//========================
		//alert($body.find('.tweet').last().created_at);
		//============================
		
		
		//INITIAL TWEET DISPLAY
		displayTweets();

		
      });

    </script>
  </body>
</html>
